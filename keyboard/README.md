# WaveKeyboard

Проект по превращению панели управления от микроволновки в USB клавиатуру.

При нажатии кнопок панель отправляет на компьютер стандартные события клавиатуры (HID Keyboard).

Так же клавиатура отображает время и может запускать бегущую строку.

## Установка на NRF52840 nice!nano

Установите [CircuitPython](https://circuitpython.org/) на плату.

Затем, установите зависимости для проекта:

```
circup install adafruit_hid
```

После этого скопируйте boot.py и code.py на устройство.

Установка завершена!

## Соответствие кнопок на панели с тем, что отправляет в ОС

| Кнопка на панели | Что отправляется в ОС |
|---|---|
| `COOK` | `C` |
| `DEFROST` | `D` |
| `REHEAT` | `R` |
| `WAVES` | `W` |
| `TIME` | `T` |
| `ELEMENTS` | `E` |
| `PLUS` | Numpad `+` |
| `MINUS` | Numpad `-` |
| `TEN_MIN` | `Z` |
| `ONE_MIN` | `Y` |
| `TEN_SEC` | `X` |
| `STOP` | `Esc` |
| `START` | `Enter` |

## Отправка команд на клавиатуру

Для отправки команд используется HID-интерфейс с параметрами:

- VID: `0x239A`
- PID: `0x80B4`
- Usage Page: `0xFF00`
- Usage: `0x01`
- Report ID: `0x04`

Структура репорта (48 байт):

- byte[0]: команда
- byte[1..47]: данные команды (неиспользуемые байты заполняйте нулями)

### Запуск бегущей строки на дисплее

Команда: `0x10`

Данные: Нуль-терминированная строка. Поддерживаются латинские буквы, цифры 0-9, символы `_`, `-` и пробел. Неподдерживаемые символы заменяются пробелом.

### Синхронизация времени

Команда: `0x12`

Данные: Unix timestamp (секунды), uint32 little-endian

### Прямое управление сегментами (Raw 7-segment)

Команда: `0x14`

Данные:
- byte[1-4]: Сырые данные сегментов для 4 цифр. Каждый байт — битовая маска сегментов 0-6, бит 7 не используется.
  ```
  Сегменты:    0
             -----
          5 |     | 1
            |  6  |
             -----
          4 |     | 2
            |     |
             -----
               3
  ```
- byte[5-6]: Битовая маска дополнительных символов (12 бит, little-endian):
  - Bit 0: Верхняя точка двоеточия между цифрами
  - Bit 1: Нижняя точка двоеточия между цифрами
  - Bit 2: Кружок
  - Bit 3: Волны
  - Bit 4: Гиря
  - Bit 5: Спираль
  - Bit 6: Градусы Цельсия
  - Bit 7: Иконка 10-1
  - Bit 8: Вентилятор
  - Bit 9: KG
  - Bit 10: Ромбик "Включение"
  - Bit 11: Звёздочки
